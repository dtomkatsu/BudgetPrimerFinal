<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Hawaii State Budget FY 2026 - Interactive Budget Explorer">
    <title>Hawaii State Budget FY 2026</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Load Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <!-- Fallback for SPA routing -->
    <script>
        // Single Page Apps for GitHub Pages
        (function() {
            var l = window.location;
            if (l.search) {
                var q = {};
                l.search.slice(1).split('&').forEach(function(v) {
                    var a = v.split('=');
                    q[a[0]] = a.slice(1).join('=').replace(/~/g, ' ');
                });
                if (q.p !== undefined) {
                    window.history.replaceState(null, null, l.pathname.slice(0, -1) + (q.p || '') + (q.q ? ('?' + q.q) : '') + l.hash);
                }
            }
        }());
    </script>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>Hawaii State Budget FY 2026</h1>
            <nav class="main-nav">
                <a href="#/" class="nav-link">Home</a>
                <a href="#/about" class="nav-link">About</a>
            </nav>
        </header>

        <main id="app">
            <!-- Content will be loaded here -->
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading budget data...</p>
            </div>
        </main>

        <footer class="app-footer">
            <p>Data Source: State of Hawaii FY26 Budget</p>
            <p>Last Updated: September 2025</p>
        </footer>
    </div>

    <script>
        // Make loadDepartments globally available
        let loadDepartments;
        
        // This function will be called after all scripts are loaded
        function initApp() {
            // Initialize the router with our routes
            const router = new Router([
                {
                    path: '/',
                    component: homePage,
                    init: initHomePage
                },
                {
                    path: '/department/:id',
                    component: departmentDetailPage,
                    init: initDepartmentDetailPage
                },
                {
                    path: '/about',
                    component: aboutPage
                },
                {
                    path: '*',
                    component: notFoundPage
                }
            ]);
            
            // Expose router for debugging
            window.router = router;
        }
        
        // Load scripts in order
        function loadScripts() {
            const scripts = [
                'js/app.js',
                'js/router.js'
            ];
            
            function loadScript(index) {
                if (index >= scripts.length) {
                    // All scripts loaded, initialize the app
                    initApp();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = scripts[index];
                script.onload = () => loadScript(index + 1);
                script.onerror = (error) => {
                    console.error(`Error loading script: ${scripts[index]}`, error);
                    document.getElementById('app').innerHTML = `
                        <div class="error-message">
                            <h2>Error Loading Application</h2>
                            <p>There was an error loading the application. Please refresh the page to try again.</p>
                        </div>`;
                };
                document.body.appendChild(script);
            }
            
            // Start loading scripts
            loadScript(0);
        }
        
        // Start loading scripts when the page is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadScripts);
        } else {
            loadScripts();
        }
    </script>
</body>
</html>
